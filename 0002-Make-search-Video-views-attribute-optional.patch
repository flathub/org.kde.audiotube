From 9bced575dc66732b10c079d1280a944ca95013b7 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Jonah=20Br=C3=BCchert?= <jbb@kaidan.im>
Date: Fri, 7 Apr 2023 16:32:41 +0200
Subject: [PATCH 2/2] Make search::Video views attribute optional

Fixes #27
---
 src/ytmusic.cpp | 5 +++--
 src/ytmusic.h   | 2 +-
 2 files changed, 4 insertions(+), 3 deletions(-)

diff --git a/src/ytmusic.cpp b/src/ytmusic.cpp
index 78d6e13..83a4048 100644
--- a/src/ytmusic.cpp
+++ b/src/ytmusic.cpp
@@ -272,16 +272,17 @@ std::optional<artist::Artist::Section<T>> extract_artist_section(py::handle arti
 
 std::optional<search::SearchResultItem> extract_search_result(py::handle result) {
     const auto resultType = result["resultType"].cast<std::string>();
+
     if (resultType == "video") {
         return search::Video {
             {
                 result["videoId"].cast<std::string>(),
                 result["title"].cast<std::string>(),
                 extract_py_list<meta::Artist>(result["artists"]),
-                result["views"].cast<std::string>(),
+                result["duration"].cast<std::string>(),
                 extract_py_list<meta::Thumbnail>(result["thumbnails"])
             },
-            result["duration"].cast<std::string>()
+            optional_key<std::string>(result, "views")
         };
     } else if (resultType == "song") {
         return search::Song {
diff --git a/src/ytmusic.h b/src/ytmusic.h
index 7611215..13c66e5 100644
--- a/src/ytmusic.h
+++ b/src/ytmusic.h
@@ -48,7 +48,7 @@ struct Media {
 };
 
 struct Video : public Media {
-    std::string views;
+    std::optional<std::string> views;
 };
 
 struct Playlist {
-- 
2.40.0

